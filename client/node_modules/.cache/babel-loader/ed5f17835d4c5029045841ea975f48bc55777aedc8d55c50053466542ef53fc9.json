{"ast":null,"code":"var _jsxFileName = \"/Users/mukulgoyal/Desktop/studies/web development/Github/Book-It-Now/client/src/component/auth/EmailVerification.jsx\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useRef, useState } from \"react\";\nimport { commonTheme } from \"../../utils/CommonTheme\";\nimport Container from \"../Container\";\nimport FormContainer from \"../form/FormContainer\";\nimport Submit from \"../form/Submit\";\nimport Title from \"../form/Title\";\nimport { useLocation, useNavigate } from \"react-router-dom\";\nimport { verifyEmail } from \"../../api/auth\";\nimport { useAuth, useNotification } from \"../../hooks\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst OTP_LENGTH = 6;\nconst validOTP = otp => {\n  let valid = false;\n  for (let val of otp) {\n    valid = !isNaN(parseInt(val)); //checking NAN value\n    if (!valid) break;\n  }\n  return valid;\n};\nconst EmailVerification = () => {\n  _s();\n  const {\n    isAuth,\n    authInfo\n  } = useAuth();\n  const {\n    isLoggedIn\n  } = authInfo;\n  const {\n    state\n  } = useLocation(); //it will tell exerything we have on this URL useLocation();\n  const {\n    updateNotification\n  } = useNotification();\n  const user = state === null || state === void 0 ? void 0 : state.user;\n  // console.log(state);\n  console.log(user);\n  const [otp, setotp] = useState(new Array(OTP_LENGTH).fill(\"\"));\n  const [activeOtpIndex, setActiveOtpIndex] = useState(0);\n  const focusNextField = index => {\n    setActiveOtpIndex(index + 1);\n  };\n  let currentOtpIndex; //this is created because as we use both onkeyDown and onChange because of that both get fire up when we type things so in order to deal with that we have to shift to currentOTPIndex instead of index\n  const focusPrevField = index => {\n    let nextIndex;\n    let diff = index - 1;\n    nextIndex = diff !== 0 ? diff : 0;\n    setActiveOtpIndex(nextIndex);\n  };\n  const inputRef = useRef();\n  const handleOtpChange = _ref => {\n    let {\n      target\n    } = _ref;\n    const {\n      value\n    } = target;\n    const newOtp = [...otp];\n    newOtp[currentOtpIndex] = value.substring(value.length - 1, value.length); //substring will remove multiple number in one box\n    if (!value) focusPrevField(currentOtpIndex);else focusNextField(currentOtpIndex);\n    setotp([...newOtp]);\n  };\n  const navigate = useNavigate();\n  const handleKeyDown = (_ref2, index) => {\n    let {\n      key\n    } = _ref2;\n    //this will {key} d-structure the e.key which tell which key is pressed\n    currentOtpIndex = index;\n    // console.log(key);\n    if (key === \"Backspace\") {\n      otp[currentOtpIndex] = \"\";\n      focusPrevField(currentOtpIndex);\n    }\n  };\n  const handleSubmit = async e => {\n    e.preventDefault();\n    if (!validOTP(otp)) return updateNotification(\"error\", \"Invalid OTP\");\n    const {\n      message,\n      error,\n      user: userResponse\n    } = await verifyEmail({\n      OTP: otp.join(\"\"),\n      userId: user.id\n    }); //otp.join(\"\") it will join whole array like ['1','2','3','4','5','6']====> '123456'\n    if (error) return updateNotification(\"error\", error);\n    localStorage.setItem(\"auth-token\", user.token);\n    isAuth();\n    updateNotification(\"success\", message);\n    // console.log(otp);\n  };\n\n  useEffect(() => {\n    var _inputRef$current;\n    (_inputRef$current = inputRef.current) === null || _inputRef$current === void 0 ? void 0 : _inputRef$current.focus();\n  }, [activeOtpIndex]);\n  useEffect(() => {\n    if (!user) return navigate(\"/Not-Found\");\n    if (!is) return navigate(\"/Not-Found\");\n  }, [user]);\n  return /*#__PURE__*/_jsxDEV(FormContainer, {\n    children: /*#__PURE__*/_jsxDEV(Container, {\n      children: /*#__PURE__*/_jsxDEV(\"form\", {\n        onSubmit: handleSubmit,\n        className: commonTheme,\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          children: [/*#__PURE__*/_jsxDEV(Title, {\n            children: \"Please enter your OTP to verify your account\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 87,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"text-center dark:text-dark-subtle text-light-subtle\",\n            children: [\" \", \"OTP has been sent to your email\", \" \"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 88,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 86,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex justify-center items-center space-x-4\",\n          children: otp.map((_, index) => {\n            return /*#__PURE__*/_jsxDEV(\"input\", {\n              ref: activeOtpIndex === index ? inputRef : null,\n              type: \"number\",\n              value: otp[index] || \"\",\n              onChange: handleOtpChange,\n              onKeyDown: e => handleKeyDown(e, index),\n              className: \"w-12 h-12 border-2 spin-button-none dark:border-dark-subtle border-light-subtle dark:focus:border-white focus:border-primary rounded bg-transparent outline-none text-center dark:text-white text-primary font-semibold text spin-button-none\"\n            }, index, false, {\n              fileName: _jsxFileName,\n              lineNumber: 96,\n              columnNumber: 17\n            }, this);\n          })\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 93,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Submit, {\n          value: \"Send Link\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 108,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex justify-between\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 109,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 85,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 84,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 83,\n    columnNumber: 5\n  }, this);\n};\n_s(EmailVerification, \"PxQfpYr2HcDiONVvoDcBLyEPnXA=\", false, function () {\n  return [useAuth, useLocation, useNotification, useNavigate];\n});\n_c = EmailVerification;\nexport default EmailVerification;\nvar _c;\n$RefreshReg$(_c, \"EmailVerification\");","map":{"version":3,"names":["React","useEffect","useRef","useState","commonTheme","Container","FormContainer","Submit","Title","useLocation","useNavigate","verifyEmail","useAuth","useNotification","jsxDEV","_jsxDEV","OTP_LENGTH","validOTP","otp","valid","val","isNaN","parseInt","EmailVerification","_s","isAuth","authInfo","isLoggedIn","state","updateNotification","user","console","log","setotp","Array","fill","activeOtpIndex","setActiveOtpIndex","focusNextField","index","currentOtpIndex","focusPrevField","nextIndex","diff","inputRef","handleOtpChange","_ref","target","value","newOtp","substring","length","navigate","handleKeyDown","_ref2","key","handleSubmit","e","preventDefault","message","error","userResponse","OTP","join","userId","id","localStorage","setItem","token","_inputRef$current","current","focus","is","children","onSubmit","className","fileName","_jsxFileName","lineNumber","columnNumber","map","_","ref","type","onChange","onKeyDown","_c","$RefreshReg$"],"sources":["/Users/mukulgoyal/Desktop/studies/web development/Github/Book-It-Now/client/src/component/auth/EmailVerification.jsx"],"sourcesContent":["import React, { useEffect, useRef, useState } from \"react\";\nimport { commonTheme } from \"../../utils/CommonTheme\";\nimport Container from \"../Container\";\nimport FormContainer from \"../form/FormContainer\";\nimport Submit from \"../form/Submit\";\nimport Title from \"../form/Title\";\nimport { useLocation, useNavigate } from \"react-router-dom\";\nimport { verifyEmail } from \"../../api/auth\";\nimport { useAuth, useNotification } from \"../../hooks\";\n\nconst OTP_LENGTH = 6;\n\nconst validOTP = (otp) => {\n  let valid = false;\n  for (let val of otp) {\n    valid = !isNaN(parseInt(val)); //checking NAN value\n    if (!valid) break;\n  }\n  return valid;\n};\nconst EmailVerification = () => {\n  const { isAuth, authInfo } = useAuth();\n  const { isLoggedIn } = authInfo;\n  const { state } = useLocation(); //it will tell exerything we have on this URL useLocation();\n  const {updateNotification} = useNotification();\n  const user = state?.user;\n  // console.log(state);\n  console.log(user);\n  const [otp, setotp] = useState(new Array(OTP_LENGTH).fill(\"\"));\n  const [activeOtpIndex, setActiveOtpIndex] = useState(0);\n  const focusNextField = (index) => {\n    setActiveOtpIndex(index + 1);\n  };\n  let currentOtpIndex; //this is created because as we use both onkeyDown and onChange because of that both get fire up when we type things so in order to deal with that we have to shift to currentOTPIndex instead of index\n  const focusPrevField = (index) => {\n    let nextIndex;\n    let diff = index - 1;\n    nextIndex = diff !== 0 ? diff : 0;\n    setActiveOtpIndex(nextIndex);\n  };\n  const inputRef = useRef();\n\n  const handleOtpChange = ({ target }) => {\n    const { value } = target;\n    const newOtp = [...otp];\n    newOtp[currentOtpIndex] = value.substring(value.length - 1, value.length); //substring will remove multiple number in one box\n    if (!value) focusPrevField(currentOtpIndex);\n    else focusNextField(currentOtpIndex);\n    setotp([...newOtp]);\n  };\n  const navigate = useNavigate();\n  const handleKeyDown = ({ key }, index) => {\n    //this will {key} d-structure the e.key which tell which key is pressed\n    currentOtpIndex = index;\n    // console.log(key);\n    if (key === \"Backspace\") {\n      otp[currentOtpIndex] = \"\";\n      focusPrevField(currentOtpIndex);\n    }\n  };\n  const handleSubmit = async (e) => {\n    e.preventDefault();\n\n    if (!validOTP(otp)) return updateNotification(\"error\", \"Invalid OTP\");\n\n    const { message, error,user:userResponse } = await verifyEmail({ OTP: otp.join(\"\"), userId: user.id });   //otp.join(\"\") it will join whole array like ['1','2','3','4','5','6']====> '123456'\n    if (error) return updateNotification(\"error\",error);\n    localStorage.setItem(\"auth-token\", user.token);\n    isAuth();\n    updateNotification(\"success\",message);\n    // console.log(otp);\n  };\n  useEffect(() => {\n    inputRef.current?.focus();\n  }, [activeOtpIndex]);\n\n  useEffect(() => {\n    if (!user) return navigate(\"/Not-Found\");\n    if (!is) return navigate(\"/Not-Found\");\n  }, [user]);\n\n  return (\n    <FormContainer>\n      <Container>\n        <form onSubmit={handleSubmit} className={commonTheme}>\n          <div>\n            <Title>Please enter your OTP to verify your account</Title>\n            <p className=\"text-center dark:text-dark-subtle text-light-subtle\">\n              {\" \"}\n              OTP has been sent to your email{\" \"}\n            </p>\n          </div>\n          <div className=\"flex justify-center items-center space-x-4\">\n            {otp.map((_, index) => {\n              return (\n                <input\n                  ref={activeOtpIndex === index ? inputRef : null}\n                  key={index}\n                  type=\"number\"\n                  value={otp[index] || \"\"}\n                  onChange={handleOtpChange}\n                  onKeyDown={(e) => handleKeyDown(e, index)}\n                  className=\"w-12 h-12 border-2 spin-button-none dark:border-dark-subtle border-light-subtle dark:focus:border-white focus:border-primary rounded bg-transparent outline-none text-center dark:text-white text-primary font-semibold text spin-button-none\"\n                />\n              );\n            })}\n          </div>\n          <Submit value=\"Send Link\" />\n          <div className=\"flex justify-between\"></div>\n        </form>\n      </Container>\n    </FormContainer>\n  );\n};\n\nexport default EmailVerification;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}